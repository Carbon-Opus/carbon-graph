type Token @entity(immutable: false) {
  id: ID! # token address
  creator: Creator!
  name: String!
  symbol: String!
  createdAt: BigInt!
  creationFee: BigInt!
  creatorAllocation: BigInt!
  graduated: Boolean!
  graduatedAt: BigInt
  dexPair: Bytes
  transactions: [Transaction!]! @derivedFrom(field: "token")
  virtualEth: BigInt!
  virtualTokens: BigInt!
  maxSupply: BigInt!
  graduationThreshold: BigInt!
  realEthReserves: BigInt!
  realTokenSupply: BigInt!
  price: BigInt!
  totalHolders: BigInt!
  holders: [Holder!]! @derivedFrom(field: "token")
  approvals: [Approval!]! @derivedFrom(field: "token")
  whaleIntents: [WhaleIntent!]! @derivedFrom(field: "token")
  isCircuitBreakerActive: Boolean!
  circuitBreakerTriggeredAt: BigInt
  circuitBreakerDuration: BigInt
}

type Creator @entity(immutable: false) {
  id: ID! # creator address
  tokens: [Token!]! @derivedFrom(field: "creator")
  createdAt: BigInt!
  totalFeesCollected: BigInt!
}

type User @entity(immutable: false) {
  id: ID! # user address
  tokens: [Holder!]! @derivedFrom(field: "user")
  approvals: [Approval!]! @derivedFrom(field: "owner")
  whaleIntents: [WhaleIntent!]! @derivedFrom(field: "trader")
  blacklisted: Boolean!
  bots: [Bot!]! @derivedFrom(field: "user")
}

type Holder @entity(immutable: false) {
  id: ID! # user address + token address
  user: User!
  token: Token!
  balance: BigInt!
}

type Transaction @entity(immutable: true) {
  id: ID! # transaction hash
  token: Token!
  type: String! # "buy", "sell", or "transfer"
  from: Bytes! # address of the sender
  to: Bytes! # address of the receiver
  ethAmount: BigInt!
  tokenAmount: BigInt!
  price: BigInt!
  timestamp: BigInt!
}

type Approval @entity(immutable: true) {
  id: ID! # transaction hash + log index
  token: Token!
  owner: User!
  spender: Bytes!
  value: BigInt!
  timestamp: BigInt!
}

type WhaleIntent @entity(immutable: false) {
  id: ID! # token address + user address
  token: Token!
  trader: User!
  amount: BigInt!
  isBuy: Boolean!
  executeAfter: BigInt!
  timestamp: BigInt!
  cancelled: Boolean!
  executed: Boolean!
}

type Bot @entity(immutable: true) {
  id: ID! # transaction hash + log index
  user: User!
  reason: String!
  timestamp: BigInt!
}

type Song @entity(immutable: false) {
  id: ID! # tokenID
  artist: Artist!
  price: BigInt!
  referralPct: BigInt!
  createdAt: BigInt!
  purchases: [SongPurchase!]! @derivedFrom(field: "song")
}

type Artist @entity(immutable: false) {
  id: ID! # artist address
  songs: [Song!]! @derivedFrom(field: "artist")
  rewards: BigInt!
  claimedRewards: [Reward!]! @derivedFrom(field: "artist")
}

type Buyer @entity(immutable: false) {
  id: ID! # buyer address
  purchases: [SongPurchase!]! @derivedFrom(field: "buyer")
}

type Referrer @entity(immutable: false) {
  id: ID! # referrer address
  referrals: [SongPurchase!]! @derivedFrom(field: "referrer")
  rewards: BigInt!
  claimedRewards: [Reward!]! @derivedFrom(field: "referrer")
}

type SongPurchase @entity(immutable: true) {
  id: ID! # transaction hash
  song: Song!
  buyer: Buyer!
  referrer: Referrer
  price: BigInt!
  timestamp: BigInt!
}

type Reward @entity(immutable: true) {
  id: ID! # transaction hash + log index
  artist: Artist
  referrer: Referrer
  amount: BigInt!
  timestamp: BigInt!
}

type Protocol @entity(immutable: false) {
  id: ID!
  totalRewardsClaimed: BigInt!
  totalRewardsDistributed: BigInt!
  protocolFee: BigInt!
  treasury: Bytes!
}
